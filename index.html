<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="This document allows you to start the game and set your username">
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico">
    <title>Document</title>
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            background-color: #2f2f2f;
            overflow: hidden;
        }
    </style>
</head>

<body>
    <canvas id="myCanvas" width="1920" height="1080"></canvas>
    <script>
        class Menu {
            options = [];
            #timestamp = 0;
            #moved = false;
            //<!--? menu is dynamic and works with multiple options. but it doen't check for overflow D:
            constructor(options = []) {
                let i = 0;
                options.forEach(e => {
                    this.options.push({
                        string: e,
                        checked: i == 0,
                        place: i
                    });
                    i++;
                });
            }

            selectDown() {
                for (let i = 0; i < this.options.length; i++) {
                    if (this.options[i].checked) {
                        this.options[i].checked = false;
                        if (i + 1 >= this.options.length) {
                            this.options[0].checked = true;
                            return;
                        }
                        this.options[i + 1].checked = true;
                        return;
                    }
                }
            }
            selectUp() {
                for (let i = this.options.length - 1; i >= 0; i--) {
                    if (this.options[i].checked) {
                        this.options[i].checked = false;
                        if (i - 1 < 0) {
                            this.options[this.options.length - 1].checked = true;
                            return;
                        }
                        this.options[i - 1].checked = true;
                        return;
                    }
                }
            }
            move(up = Boolean){
                if (up){
                    for (let i = this.options.length - 1; i >= 0; i--) {
                        if (this.options[i].checked) {
                            this.options[i].checked = false;
                            if (i - 1 < 0) {
                                this.options[this.options.length - 1].checked = true;
                                return;
                            }
                            this.options[i - 1].checked = true;
                            return;
                        }
                    }
                }
                for (let i = 0; i < this.options.length; i++) {
                    if (this.options[i].checked) {
                        this.options[i].checked = false;
                        if (i + 1 >= this.options.length) {
                            this.options[0].checked = true;
                            return;
                        }
                        this.options[i + 1].checked = true;
                        return;
                    }
                }
            }

            updateMenu(timestamp) {
                if ((pressedKeys['arrowup'] || pressedKeys['w'])  && !this.#moved) {
                    this.#moved = true;
                    this.#timestamp = timestamp;
                    menu.selectUp();
                    return;
                }
                if ((pressedKeys['arrowdown'] || pressedKeys['s'])  && !this.#moved) {
                    this.#moved = true;
                    this.#timestamp = timestamp;
                    menu.selectDown();
                    return;
                }
                if (this.#moved && timestamp - this.#timestamp >= 100) {
                    this.#moved = false;
                    return;
                }
                if (pressedKeys['enter']){
                    this.options.forEach(e => {
                        if (e.checked){
                            if (e.string.toLowerCase() == 'start'){
                                const user = prompt('Enter a username!');
                                localStorage.setItem('username', user);
                                window.location.replace('/game.html');
                            }
                            if (e.string.toLowerCase() == 'options'){
                                console.log('options');
                                window.location.replace('https://www.google.si/');
                            }
                        }
                        
                    });
                }
            }

        };

        const canvas = document.getElementById('myCanvas');
        /** @type {CanvasRenderingContext2D} */
        const ctx = canvas.getContext('2d');

        let menu = new Menu(['Start', 'Options'/*, 'Test', 'Aha', 'Uhu'*/]); // Works with more than two ! 
        let pressedKeys = {};
        let lastFrame = 0;

        addEventListener('keyup', handleKey, false);
        addEventListener('keydown', handleKey, false);

        window.requestAnimationFrame(update);

        function handleKey(event) {
            pressedKeys[event.key.toLowerCase()] = event.type == 'keydown';
            // console.log(pressedKeys);
        }



// <!--. Actual important code




        function update(timestamp) {
            let progress = timestamp - lastFrame;
            lastFrame = timestamp;
            menu.updateMenu(timestamp);
            draw();
            window.requestAnimationFrame(update);
        }

        function draw() {
            ctx.fillStyle = 'white';
            ctx.font = '30px Arial';
            ctx.clearRect(0, 0, canvas.clientWidth, canvas.clientHeight);
            menu.options.forEach(e => {
                if (e.checked) {
                    ctx.lineWidth = 6;
                    ctx.strokeStyle = '#F2F2F2';
                    ctx.beginPath();
                    ctx.moveTo(window.innerWidth * 0.5 - 10, 120 + e.place * 32);
                    ctx.lineTo(window.innerWidth * 0.5 - 20, 120 + e.place * 32);
                    ctx.stroke();
                }
                ctx.fillText(e.string, window.innerWidth * 0.5 , 130 + e.place * 32);
            });
        }

    </script>
</body>

</html>